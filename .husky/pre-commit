#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Executando testes..."

# Executa todos os testes
npx jest --bail
TEST_EXIT_CODE=$?

if [ $TEST_EXIT_CODE -ne 0 ]; then
  echo "‚ùå Commit abortado! H√° testes falhando."
  exit 1
fi

# Inicia o servidor em segundo plano para Cypress
npm run dev &
SERVER_PID=$!

# Aguarda o servidor iniciar
sleep 5

# Executa os testes do Cypress
npx cypress run

# Finaliza o servidor
kill $SERVER_PID

echo "‚úÖ Todos os testes passaram. Continuando o commit."
exit 0

